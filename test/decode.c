#include <stdio.h>

#include <stdint.h>

void
disp(uint32_t output, uint32_t expected) {
	if (output != expected) {
		printf("%08X != %08X" "\n", output, expected);
	}
}

uint32_t
test_b(uint32_t instr, uint32_t expected) {
	uint32_t imm = (((instr >> 31) & 0b1) << 12) | (((instr >> 7) & 0b1) << 11) | (((instr >> 25) & 0b111111) << 5) | (((instr >> 8) & 0b1111) << 1);
	disp(imm, expected);
	return imm;
}

uint32_t
test_j(uint32_t instr, uint32_t expected) {
	// 31   30 21   20   19 12
	// 20   10: 1   11   19:12
	uint32_t imm = (((instr >> 31) & 0b1) << 20) | (((instr >> 12) & 0b11111111) << 12) | (((instr >> 20) & 0b1) << 11) | (((instr >> 21) & 0b1111111111) << 1);
	disp(imm, expected);
	return imm;
}

int
main() {
	test_b( (0b0000000 << 25) | (0b00010 << 7), 1 <<  1);
	test_b( (0b0000000 << 25) | (0b00100 << 7), 1 <<  2);
	test_b( (0b0000000 << 25) | (0b01000 << 7), 1 <<  3);
	test_b( (0b0000000 << 25) | (0b10000 << 7), 1 <<  4);
	test_b( (0b0000001 << 25) | (0b00000 << 7), 1 <<  5);
	test_b( (0b0000010 << 25) | (0b00000 << 7), 1 <<  6);
	test_b( (0b0000100 << 25) | (0b00000 << 7), 1 <<  7);
	test_b( (0b0001000 << 25) | (0b00000 << 7), 1 <<  8);
	test_b( (0b0010000 << 25) | (0b00000 << 7), 1 <<  9);
	test_b( (0b0100000 << 25) | (0b00000 << 7), 1 << 10);
	test_b( (0b0000000 << 25) | (0b00001 << 7), 1 << 11);
	test_b( (0b1000000 << 25) | (0b00000 << 7), 1 << 12);

	test_j( 0b00000000001000000000 << 12, 1 <<  1);
	test_j( 0b00000000010000000000 << 12, 1 <<  2);
	test_j( 0b00000000100000000000 << 12, 1 <<  3);
	test_j( 0b00000001000000000000 << 12, 1 <<  4);
	test_j( 0b00000010000000000000 << 12, 1 <<  5);
	test_j( 0b00000100000000000000 << 12, 1 <<  6);
	test_j( 0b00001000000000000000 << 12, 1 <<  7);
	test_j( 0b00010000000000000000 << 12, 1 <<  8);
	test_j( 0b00100000000000000000 << 12, 1 <<  9);
	test_j( 0b01000000000000000000 << 12, 1 << 10);
	test_j( 0b00000000000100000000 << 12, 1 << 11);
	test_j( 0b00000000000000000001 << 12, 1 << 12);
	test_j( 0b00000000000000000010 << 12, 1 << 13);
	test_j( 0b00000000000000000100 << 12, 1 << 14);
	test_j( 0b00000000000000001000 << 12, 1 << 15);
	test_j( 0b00000000000000010000 << 12, 1 << 16);
	test_j( 0b00000000000000100000 << 12, 1 << 17);
	test_j( 0b00000000000001000000 << 12, 1 << 18);
	test_j( 0b00000000000010000000 << 12, 1 << 19);
	test_j( 0b10000000000000000000 << 12, 1 << 20);

	return 0;
}

